<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Expense Tracker - Signup & Login</title>

    <!-- Bootstrap CSS -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />

    <!-- Axios (for making POST requests) -->
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>

    <style>
      body {
        background-color: #f8f9fa;
      }

      .form-container {
        max-width: 500px;
        margin: 50px auto;
        padding: 20px;
        background-color: #fff;
        border-radius: 8px;
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
      }

      .error-message {
        color: red;
        margin-top: 10px;
        display: none;
      }

      .success-message {
        color: green;
        margin-top: 10px;
        display: none;
      }

      .form-toggle {
        margin-top: 20px;
        text-align: center;
      }

      .form-toggle a {
        cursor: pointer;
      }
    </style>
  </head>

  <body>
    <div class="container">
      <div class="form-container">
        <!-- Signup Form -->
        <div id="signupForm" style="display: block">
          <h2 class="text-center">Sign Up</h2>
          <form>
            <div class="mb-3">
              <label for="signup-username" class="form-label">Username</label>
              <input
                type="text"
                class="form-control"
                id="signup-username"
                placeholder="Enter username"
                required
              />
            </div>

            <div class="mb-3">
              <label for="signup-email" class="form-label">Email address</label>
              <input
                type="email"
                class="form-control"
                id="signup-email"
                placeholder="Enter email"
                required
              />
            </div>

            <div class="mb-3">
              <label for="signup-password" class="form-label">Password</label>
              <input
                type="password"
                class="form-control"
                id="signup-password"
                placeholder="Enter password"
                required
              />
            </div>

            <button type="submit" class="btn btn-primary w-100">Sign Up</button>

            <!-- Display error or success messages -->
            <div id="signupErrorMessage" class="error-message"></div>
            <div id="signupSuccessMessage" class="success-message"></div>
          </form>

          <!-- Toggle to login form -->
          <div class="form-toggle">
            <p>Already have an account? <a id="showLoginForm">Login</a></p>
          </div>
        </div>

        <!-- Login Form -->
        <div id="loginForm" style="display: none">
          <h2 class="text-center">Login</h2>
          <form>
            <div class="mb-3">
              <label for="login-email" class="form-label">Email address</label>
              <input
                type="email"
                class="form-control"
                id="login-email"
                placeholder="Enter email"
                required
              />
            </div>

            <div class="mb-3">
              <label for="login-password" class="form-label">Password</label>
              <input
                type="password"
                class="form-control"
                id="login-password"
                placeholder="Enter password"
                required
              />
            </div>

            <button type="submit" class="btn btn-primary w-100">Login</button>

            <!-- Display error or success messages -->
            <div id="loginErrorMessage" class="error-message"></div>
            <div id="loginSuccessMessage" class="success-message"></div>
          </form>

          <!-- Toggle to signup form -->
          <div class="form-toggle">
            <p>Don't have an account? <a id="showSignupForm">Sign Up</a></p>
          </div>
        </div>
      </div>
    </div>

    <!-- Bootstrap JS and Popper.js -->
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.6/dist/umd/popper.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.min.js"></script>

    <!-- JavaScript for handling form toggling and submission -->
    <script>
      // Toggle between signup and login forms
      document
        .getElementById("showLoginForm")
        .addEventListener("click", function () {
          document.getElementById("signupForm").style.display = "none";
          document.getElementById("loginForm").style.display = "block";
        });

      document
        .getElementById("showSignupForm")
        .addEventListener("click", function () {
          document.getElementById("signupForm").style.display = "block";
          document.getElementById("loginForm").style.display = "none";
        });

      // Handle Signup Form Submission
      document
        .querySelector("#signupForm form")
        .addEventListener("submit", function (event) {
          event.preventDefault();

          // Clear previous messages
          document.getElementById("signupErrorMessage").style.display = "none";
          document.getElementById("signupSuccessMessage").style.display =
            "none";

          // Collect form data
          const username = document.getElementById("signup-username").value;
          const email = document.getElementById("signup-email").value;
          const password = document.getElementById("signup-password").value;

          // Prepare data for signup
          const userData = { username, email, password };

          // Send POST request using Axios
          axios
            .post("/home/signupdetails", userData)
            .then((response) => {
              if (response.status === 201) {
                document.getElementById("signupSuccessMessage").innerText =
                  "User registered successfully!";
                document.getElementById("signupSuccessMessage").style.display =
                  "block";
              }
            })
            .catch((error) => {
              if (error.response && error.response.status === 400) {
                document.getElementById("signupErrorMessage").innerText =
                  "Email already exists.";
                document.getElementById("signupErrorMessage").style.display =
                  "block";
              } else {
                document.getElementById("signupErrorMessage").innerText =
                  "Error registering user. Please try again.";
                document.getElementById("signupErrorMessage").style.display =
                  "block";
              }
            });
        });

      // Handle Login Form Submission
      document
        .querySelector("#loginForm form")
        .addEventListener("submit", function (event) {
          event.preventDefault();

          // Clear previous messages
          document.getElementById("loginErrorMessage").style.display = "none";
          document.getElementById("loginSuccessMessage").style.display = "none";

          // Collect form data
          const email = document.getElementById("login-email").value;
          const password = document.getElementById("login-password").value;

          // Prepare data for login
          const loginData = { email, password };

          // Send POST request using Axios
          axios
            .post("/home/isvalid", loginData)
            .then((response) => {
              if (response.status === 200) {
                document.getElementById("loginSuccessMessage").innerText =
                  "Login successful!";
                document.getElementById("loginSuccessMessage").style.display =
                  "block";
              }
              setTimeout(() => {
            window.location.href = "/expense"; // Change this to your actual expense page URL
          }, 1000); // Delay of 1 second before redirecting
            })
      })
          //  })
            .catch((error) => {
              document.getElementById("loginErrorMessage").innerText =
                "Invalid email or password.";
              document.getElementById("loginErrorMessage").style.display =
                "block";
            });
       // });
    </script>
  </body>
</html>
